<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial Angular: Parte 8 - Pipes</title>
    <link rel="stylesheet" href="./assets/css/prism-tomorrow.min.css">
    <script src="./assets/js/prism.min.js"></script>
    <script src="./assets/js/prism-typescript.min.js"></script>
    <link rel="stylesheet" href="./assets/css/all.min.css">
    <link rel="stylesheet" href="./assets/css/animate.min.css">
    <style>
        /* --- Copiado y adaptado de tema7 --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        nav {
            position: fixed;
            left: 0;
            top: 80px;
            width: 250px;
            height: calc(100vh - 80px);
            background: white;
            overflow-y: auto;
            padding: 1rem 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        nav ul { list-style: none; padding: 0; }
        nav li { padding: 0.5rem 1rem; }
        nav a { text-decoration: none; color: #333; display: block; transition: background 0.3s; }
        nav a:hover { background: #f0f0f0; border-right: 3px solid #667eea; }
        main { margin-left: 250px; padding: 2rem; max-width: 1000px; counter-reset: theme-counter; }
        section { margin-bottom: 2.5rem; background: white; padding: 1.6rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); animation: fadeInUp 0.6s ease-out; }
        section h2 { display:flex; align-items:center; gap:0.75rem; font-size:1.25rem; }
        section h2::before {
            counter-increment: theme-counter;
            content: counter(theme-counter);
            display:inline-flex; align-items:center; justify-content:center;
            width:2.1rem; height:2.1rem; background: linear-gradient(135deg,#5a67d8 0%,#7b61d1 100%);
            color:white; border-radius:50%; font-weight:700; box-shadow:0 4px 10px rgba(102,126,234,0.18);
            transform:translateY(0); transition: transform 0.25s ease, box-shadow 0.25s ease;
        }
        section:hover h2::before { transform: translateY(-4px); box-shadow: 0 8px 18px rgba(102,126,234,0.22); }
        section h2 i { color:#667eea; font-size:1.05rem; transition: transform 0.35s cubic-bezier(.2,.8,.2,1), color 0.35s; }
        section h2 i.animate-icon { animation: iconFloat 3.5s ease-in-out infinite; opacity: 0.95; }
        @keyframes iconFloat { 0%{transform:translateY(0);}50%{transform:translateY(-6px);}100%{transform:translateY(0);} }
        section h2:hover i { transform: translateY(-3px) scale(1.06); color: #5a67d8; }
        @media (max-width:600px){ section h2::before { width:1.8rem; height:1.8rem; font-size:0.95rem;} section h2 { font-size:1.05rem; } }

        /* Enumeración tipo pasos dentro de secciones */
        ol { counter-reset: step-counter; }
        ol li { counter-increment: step-counter; position: relative; padding-left: 2rem; }
        ol li::before {
            content: counter(step-counter); position: absolute; left: 0; top: 0; background: #667eea; color: white; width: 1.5rem; height: 1.5rem; border-radius: 50%; display:flex; align-items:center; justify-content:center; font-size:0.8rem;
        }

        /* BLOQUES DE CÓDIGO: permitimos que Prism coloree la sintaxis. */
        pre {
            background: #1e1e2a; /* fondo tipo editor */
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            box-shadow: inset 0 -2px 0 rgba(255,255,255,0.02);
            margin: 0.8rem 0;
        }
        /* NO forzamos color al code para que Prism aplique estilos de sintaxis */
        code { font-family: 'Fira Code', monospace; color: inherit; }

        /* Notas, tips, warnings */
        .note { background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1rem 0; }
        .tip { background: #d4edda; border-left: 4px solid #28a745; padding: 1rem; margin: 1rem 0; }
        .warning { background: #f8d7da; border-left: 4px solid #dc3545; padding: 1rem; margin: 1rem 0; }

        /* Pequeñas utilidades */
        .muted { color: #666; font-size:0.95rem; }
        .example { margin-top: 0.6rem; }
    </style>
</head>
<body>
    <header>
        <h1>Tutorial Angular: Parte 8 — Pipes (Guía práctica y ejemplos)</h1>
    </header>

    <nav>
        <ul>
            <li><a href="#what-pipes"><i class="fas fa-filter animate-icon"></i> Entendiendo las Pipes</a></li>
            <li><a href="#builtin"><i class="fas fa-cogs animate-icon"></i> Pipes incorporadas</a></li>
            <li><a href="#more-builtin"><i class="fas fa-list-alt animate-icon"></i> Más pipes incorporadas</a></li>
            <li><a href="#create-pipe"><i class="fas fa-plus-square animate-icon"></i> Crear pipe personalizada</a></li>
            <li><a href="#custom-transform"><i class="fas fa-wrench animate-icon"></i> Pipes personalizadas para transformaciones</a></li>
            <li><a href="#pipe-params"><i class="fas fa-sliders-h animate-icon"></i> Recibir parámetros en pipes</a></li>
            <li><a href="#chain-pipes"><i class="fas fa-link animate-icon"></i> Encadenar pipes</a></li>
            <li><a href="#sort-pipe"><i class="fas fa-sort-amount-up animate-icon"></i> Pipes para ordenar</a></li>
            <li><a href="#execute-pipes"><i class="fas fa-play-circle animate-icon"></i> Cómo se ejecutan las pipes</a></li>
            <li><a href="#pure-impure"><i class="fas fa-balance-scale animate-icon"></i> Pipes puras e impuras</a></li>
            <li><a href="#limits"><i class="fas fa-exclamation-triangle animate-icon"></i> Limitaciones de las pipes</a></li>
        </ul>
    </nav>

    <main>
        <!-- 1 -->
        <section id="what-pipes">
            <h2><i class="fas animate-icon fa-filter"></i> Entendiendo las Pipes</h2>
            <p class="muted">Qué trata: Introducción al concepto de pipes en Angular: transformadores de valores usados en plantillas para formatear datos de forma declarativa.</p>
            <p>Explicación breve: Las pipes reciben un valor (y opcionalmente parámetros) y devuelven una representación transformada; se usan con la sintaxis <code>|</code> en la plantilla. Son ideales para formateo de fechas, números, texto y para composiciones simples sin lógica de negocio compleja.</p>

            <div class="example">
                <pre><code class="language-html">&lt;!-- Uso simple en plantilla --&gt;
&lt;p&gt;Hoy: {{ today | date:'fullDate' }}&lt;/p&gt;
&lt;p&gt;Precio: {{ price | currency:'USD' }}&lt;/p&gt;
&lt;p&gt;Nombre: {{ name | uppercase }}&lt;/p&gt;</code></pre>
            </div>

            <div class="note">
                Las pipes mejoran la legibilidad de las plantillas: separan la presentación (formatos) de la lógica del componente.
            </div>
        </section>

        <!-- 2 -->
        <section id="builtin">
            <h2><i class="fas animate-icon fa-cogs"></i> Pipes Incorporadas en Angular</h2>
            <p class="muted">Qué trata: Resumen de las pipes más usadas que Angular trae por defecto.</p>
            <p>Explicación breve: Angular incluye pipes como <code>date</code>, <code>currency</code>, <code>percent</code>, <code>decimal</code>, <code>uppercase</code>, <code>lowercase</code>, <code>json</code> y <code>async</code>. Estas cubren la mayoría de necesidades de presentación.</p>

            <div class="example">
                <pre><code class="language-typescript">// En plantilla (HTML)
&lt;p&gt;Fecha corta: {{ fecha | date:'shortDate' }}&lt;/p&gt;
&lt;p&gt;Moneda: {{ total | currency:'EUR' }}&lt;/p&gt;
&lt;p&gt;Porcentaje: {{ ratio | percent:'1.0-2' }}&lt;/p&gt;
&lt;p&gt;JSON (depuración): &lt;pre&gt;{{ objeto | json }}&lt;/pre&gt;</code></pre>
            </div>

            <div class="tip">Tip: La pipe <code>async</code> es especialmente útil para subscribirse a Observables/Promises directamente en la plantilla.</div>
        </section>

        <!-- 3 -->
        <section id="more-builtin">
            <h2><i class="fas animate-icon fa-list-alt"></i> Más Pipes Incorporadas</h2>
            <p class="muted">Qué trata: Pipes menos evidentes pero útiles para internacionalización, números y texto.</p>
            <p>Explicación breve: Pipes como <code>slice</code> (strings/arrays), <code>i18nPlural</code> / <code>i18nSelect</code> (pluralización) ayudan en casos de UI y locales. Aunque i18n tiene su propia API, las pipes facilitan pequeñas transformaciones.</p>

            <div class="example">
                <pre><code class="language-html">&lt;!-- slice en arrays/strings --&gt;
&lt;p&gt;Resumen: {{ text | slice:0:100 }}...&lt;/p&gt;

&lt;!-- pluralización simple --&gt;
&lt;p&gt;{{ heroes.length | i18nPlural: heroMap }}&lt;/p></code></pre>
            </div>
        </section>

        <!-- 4 -->
        <section id="create-pipe">
            <h2><i class="fas animate-icon fa-plus-square"></i> Crear una Pipe Personalizada en Angular</h2>
            <p class="muted">Qué trata: Cómo definir una pipe propia para encapsular transformaciones específicas de la aplicación.</p>
            <p>Explicación breve: Una pipe personalizada se crea implementando la interfaz <code>PipeTransform</code> y decorándola con <code>@Pipe</code>. Se puede registrar en un módulo o usar providedIn 'root'.</p>

            <div class="example">
                <pre><code class="language-typescript">import { Pipe, PipeTransform } from '@angular/core';

@Pipe({ name: 'truncate' })
export class TruncatePipe implements PipeTransform {
  transform(value: string, length = 30, ellipsis = '...'): string {
    if (!value) return '';
    return value.length > length ? value.slice(0, length) + ellipsis : value;
  }
}

<!-- Uso -->
&lt;p&gt;{{ longText | truncate:50 }}&lt;/p&gt;</code></pre>
            </div>

            <div class="note">Consejo: Mantén las pipes simples y puras (sin efectos laterales) para aprovechar el rendimiento de Angular.</div>
        </section>

        <!-- 5 -->
        <section id="custom-transform">
            <h2><i class="fas animate-icon fa-wrench"></i> Pipes Personalizadas para Transformaciones a Medida</h2>
            <p class="muted">Qué trata: Ejemplos de pipes para validación visual, formateo empresarial o simplificar plantillas.</p>
            <p>Explicación breve: Puedes crear pipes que conviertan códigos a etiquetas legibles, calculen estados derivados o filtren colecciones (aunque filtrar arrays en pipes puede provocar problemas de rendimiento si no es puro).</p>

            <div class="example">
                <pre><code class="language-typescript">// Pipe para mostrar etiqueta a partir de un código
@Pipe({ name: 'statusLabel' })
export class StatusLabelPipe implements PipeTransform {
  transform(code: string) {
    const map: Record<string,string> = {
      A: 'Activo', I: 'Inactivo', P: 'Pendiente'
    };
    return map[code] ?? 'Desconocido';
  }
}

<!-- Uso -->
&lt;span&gt;Estado: {{ user.status | statusLabel }}&lt;/span&gt;</code></pre>
            </div>
        </section>

        <!-- 6 -->
        <section id="pipe-params">
            <h2><i class="fas animate-icon fa-sliders-h"></i> Recibir Parámetros en Pipes Personalizadas</h2>
            <p class="muted">Qué trata: Mostrar cómo pasar argumentos a una pipe desde la plantilla.</p>
            <p>Explicación breve: Los parámetros adicionales se definen después del pipe separados por dos puntos. En TypeScript se reciben como argumentos de la función transform.</p>

            <div class="example">
                <pre><code class="language-typescript">// Pipe que ajusta la precisión de un número
@Pipe({ name: 'round' })
export class RoundPipe implements PipeTransform {
  transform(value: number, precision = 0): number {
    const factor = Math.pow(10, precision);
    return Math.round(value * factor) / factor;
  }
}

<!-- Uso -->
&lt;span&gt;{{ amount | round:2 }}&lt;/span&gt;  &lt;!-- redondea a 2 decimales --&gt;</code></pre>
            </div>

            <div class="tip">Tip: Puedes encadenar parámetros múltiples; maneja valores por defecto en la pipe para mayor robustez.</div>
        </section>

        <!-- 7 -->
        <section id="chain-pipes">
            <h2><i class="fas animate-icon fa-link"></i> Encadenar Pipes en Angular</h2>
            <p class="muted">Qué trata: Cómo usar varias pipes en secuencia para transformaciones compuestas.</p>
            <p>Explicación breve: Las pipes se aplican de izquierda a derecha: el resultado de la primera entra en la siguiente. Esto mantiene la plantilla declarativa pero evita lógica compleja en la vista.</p>

            <div class="example">
                <pre><code class="language-html">&lt;!-- Encadenamiento: formateo luego truncado --&gt;
&lt;p&gt;{{ dateValue | date:'short' | uppercase }}&lt;/p&gt;

&lt;!-- Texto: limpiar, luego truncar --&gt;
&lt;p&gt;{{ description | stripHtml | truncate:100 }}&lt;/p&gt;</code></pre>
            </div>
        </section>

        <!-- 8 -->
        <section id="sort-pipe">
            <h2><i class="fas animate-icon fa-sort-amount-up"></i> Pipes para Ordenar Elementos</h2>
            <p class="muted">Qué trata: Estrategias para ordenar listas con pipes y cuándo evitar hacerlo en la vista.</p>
            <p>Explicación breve: Aunque es posible crear una pipe que ordene arrays, si la ordenación es costosa o depende de datos cambiantes a menudo, es preferible ordenar en el componente/servicio y exponer el resultado (mejor para rendimiento).</p>

            <div class="example">
                <pre><code class="language-typescript">// Pipe pura para ordenar (cuidado con rendimiento si la lista cambia frecuentemente)
@Pipe({ name: 'sortBy', pure: true })
export class SortByPipe implements PipeTransform {
  transform<T>(items: T[], field: keyof T, desc = false): T[] {
    if (!items) return [];
    return [...items].sort((a,b) => {
      const A = (a[field] as any);
      const B = (b[field] as any);
      if (A < B) return desc ? 1 : -1;
      if (A > B) return desc ? -1 : 1;
      return 0;
    });
  }
}

<!-- Uso -->
&lt;li *ngFor="let item of items | sortBy:'name'"&gt;{{ item.name }}&lt;/li&gt;</code></pre>
            </div>

            <div class="note">Recomendación: para listas grandes o actualizaciones frecuentes, ordenar en el componente (o servicio) y exponer una referencia estable es preferible.</div>
        </section>

        <!-- 9 -->
        <section id="execute-pipes">
            <h2><i class="fas animate-icon fa-play-circle"></i> Cómo Ejecutar Pipes en Angular</h2>
            <p class="muted">Qué trata: Entender el momento y frecuencia de ejecución de una pipe.</p>
            <p>Explicación breve: Las pipes puras se ejecutan cuando cambian las referencias de sus entradas; las impuras se ejecutan en cada ciclo de detección de cambios. Esto afecta rendimiento: preferir pipes puras siempre que sea posible.</p>

            <div class="example">
                <pre><code class="language-typescript">// Ejemplo didáctico: contar ejecuciones de una pipe
@Pipe({ name: 'countExec', pure: true })
export class CountExecPipe implements PipeTransform {
  calls = 0;
  transform(value: any) {
    this.calls++;
    console.log('countExec llamadas:', this.calls);
    return value;
  }
}

<!-- En la plantilla -->
&lt;div&gt;{{ data | countExec }}&lt;/div&gt;</code></pre>
            </div>
        </section>

        <!-- 10 -->
        <section id="pure-impure">
            <h2><i class="fas animate-icon fa-balance-scale"></i> Pipes Puras e Impuras</h2>
            <p class="muted">Qué trata: Diferencias clave entre pipes puras e impuras y cuándo usar cada una.</p>
            <p>Explicación breve: Una pipe pura (por defecto) se ejecuta solo cuando su entrada cambia por referencia. Una pipe impura (configuración <code>pure:false</code>) se ejecuta en cada ciclo de detección de cambios — útil cuando trabajas con arrays/objetos mutables, pero puede impactar el rendimiento.</p>

            <div class="example">
                <pre><code class="language-typescript">// Pipe impura ejemplo: recalcula en cada ciclo
@Pipe({ name: 'filterImpure', pure: false })
export class FilterImpurePipe implements PipeTransform {
  transform(items: any[], term: string) {
    if (!items) return [];
    return items.filter(i =&gt; i.name.includes(term));
  }
}

<!-- Uso (cuidado con rendimiento) -->
&lt;li *ngFor="let it of items | filterImpure:search"&gt;{{ it.name }}&lt;/li&gt;</code></pre>
            </div>

            <div class="warning">Precaución: Usa pipes impuras solo cuando no puedas cambiar la referencia del input (por ejemplo cuando una librería muta arrays) y mide el impacto.</div>
        </section>

        <!-- 11 -->
        <section id="limits">
            <h2><i class="fas animate-icon fa-exclamation-triangle"></i> Limitaciones de las Pipes en Angular</h2>
            <p class="muted">Qué trata: Casos donde las pipes no son la mejor opción y alternativas recomendadas.</p>
            <p>Explicación breve: Las pipes no deben usarse para lógica compleja, llamadas HTTP, accesos al DOM o efectos secundarios. Para transformaciones costosas o que cambian frecuentemente, mover la lógica al componente/servicio (pre-calcular y exponer) es más eficiente.</p>

            <div class="example">
                <pre><code class="language-typescript">// Evita hacer esto en una pipe:
@Pipe({ name: 'fetchData' })
export class FetchDataPipe implements PipeTransform {
  transform(id: string) {
    // MAL: peticiones HTTP dentro de una pipe
    // Las pipes no están pensadas para side-effects
    return fetch(`/api/item/${id}`).then(r =&gt; r.json());
  }
}

// Alternativa: servicio que expone datos y component que usa async pipe
// service.getItem(id) -> Observable
// template: {{ service.getItem(id) | async | json }}</code></pre>
            </div>

            <div class="tip">Regla práctica: pipes = transformación pura de presentación; servicios/componentes = lógica/IO/estado.</div>
        </section>

    </main>
</body>
</html>
